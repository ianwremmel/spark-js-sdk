/*!
 *
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

// Disable eslint because this file needs to be es5 compatible
/* eslint-disable */

import testUsers from '@ciscospark/test-helper-test-users';
import '@ciscospark/internal-plugin-encryption';
import SparkCore from '@ciscospark/spark-core';

before(function() {
  this.timeout(60000);

  if (global.spark) {
    return Promise.resolve();
  }

  return testUsers.create({count: 2})
    .then(function(users) {
      /* eslint camelcase: [0] */
      const spark = global.spark = new SparkCore({credentials: users[0].token});
      global.alice = users[1];
      return spark.internal.encryption.kms.createUnboundKeys()
    })
    .then(([key]) => spark.internal.encryption.kms.createResource({
      userIds: [spark.internal.device.userId],
      key
    }))
    .then((k) => {
      global.kro = k
    });
});
