# @ciscospark/helper-roap

[![standard-readme compliant](https://img.shields.io/badge/readme%20style-standard-brightgreen.svg?style=flat-square)](https://github.com/RichardLitt/standard-readme)

> State machine for keeping track of ROAP messaging state.

## Install

Generally, you shouldn't install this package explicitly. You'll get it as a dependency of `@ciscospark/plugin-phone`.

```bash
npm install --save @ciscospark/helper-roap
```

## Usage

This helper encapselates the rules for when and what kind of messages to exchange with the Spark backend when negotiating or renegotiating an Audio/Video Experience's media state. It *does not* generate, transmit, or receive those messages, it only accepts and emits them. That said, when you intend to transmit an offer or an answer, you should invoke the `Helper#transmitOffer` and `Helper#transmitAnswer()` methods to keep the internal state machine updated. From there, the helper will emit the `transmit` event that you'll use to pass the raw message to the service.

### Methods

- `Helper#receive(RoapMessage|Object)`: Invoke this method when a roap message arrives from the backend either via HTTP Response or WebSocket message
- `Helper#transmitAnswer()`: Updates internal state, then emits the `transmit` event so that the message can be transmitted via the appropriate messaging channel.
- `Helper#transmitError()`: Updates internal state, then emits the `transmit` event so that the message can be transmitted via the appropriate messaging channel.
- `Helper#transmitOffer()`: Updates internal state, then emits the `transmit` event so that the message can be transmitted via the appropriate messaging channel.
- `Helper#transmitOfferRequest()`: Updates internal state, then emits the `transmit` event so that the message can be transmitted via the appropriate messaging channel.
- `Helper#transmitOk()`: Updates internal state, then emits the `transmit` event so that the message can be transmitted via the appropriate messaging channel.

### Events
- `transmit`: Emitted when there's a new ROAP message to send to the service.
- `receiveOffer`: Emitted when an offer has been received and needs to be processed.
- `receiveOfferRequest`: Emitted when an offer request has been received and needs to be processed.
- `receiveAnswer`: Emitted when an answer has been received and needs to be processed.
- `receiveOk`:  Emitted when an ok has been received and needs to processed
- `receiveError`: Emitted when an error has been received and needs to be processed
- `transactionTimeout`: Emitted when, even after retransmission, no response is received from the service.

## Maintainers

[@ianwremmel](https://github.com/ianwremmel)
[@adamweeks](https://github.com/adamweeks)
[@bzang](https://github.com/bzang)

## Contribute

Pull requests welcome. Please see [CONTRIBUTING.md](../../CONTRIBUTING.md) for more details.

## License

Â© 2016-2017 Cisco and/or its affiliates. All Rights Reserved.
